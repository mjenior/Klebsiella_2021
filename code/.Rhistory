# Transcriptomic analysis
metadata <- read.delim('~/Desktop/repos/Klebsiella_2021/data/metadata.tsv', sep='\t', header=TRUE)
clinical_srr <- as.vector(subset(metadata, type == 'clinical')[,1])
laboratory_srr <- as.vector(subset(metadata, type == 'laboratory')[,1])
rm(metadata)
current <- paste0('~/Desktop/active_projects/klebsiella/data/transcript_mapping/', clinical_srr[1], '.mapped.tsv')
clinical_transcription <- read.delim(current, sep='\t', header=FALSE, row.names=1)
colnames(clinical_transcription) <- paste0(clinical_srr[1],'_', 1:ncol(clinical_transcription))
for (x in 2:length(clinical_srr)) {
current <- paste0('~/Desktop/active_projects/klebsiella/data/transcript_mapping/', clinical_srr[x], '.mapped.tsv')
current <- read.delim(current, sep='\t', header=FALSE, row.names=1)
colnames(current) <- paste0(clinical_srr[x],'_', 1:ncol(current))
clinical_transcription <- merge(clinical_transcription, current, by='row.names')
rownames(clinical_transcription) <- clinical_transcription$Row.names
clinical_transcription$Row.names <- NULL}
rm(clinical_srr, x, current)
clinical_transcription <- as.data.frame(t(clinical_transcription))
clinical_transcription$`*` <- NULL
current <- paste0('~/Desktop/active_projects/klebsiella/data/transcript_mapping/', laboratory_srr[1], '.mapped.tsv')
laboratory_transcription <- read.delim(current, sep='\t', header=FALSE, row.names=1)
colnames(laboratory_transcription) <- paste0(laboratory_srr[1],'_', 1:ncol(laboratory_transcription))
for (x in 2:length(laboratory_srr)) {
current <- paste0('~/Desktop/active_projects/klebsiella/data/transcript_mapping/', laboratory_srr[x], '.mapped.tsv')
current <- read.delim(current, sep='\t', header=FALSE, row.names=1)
colnames(current) <- paste0(laboratory_srr[x],'_', 1:ncol(current))
laboratory_transcription <- merge(laboratory_transcription, current, by='row.names')
rownames(laboratory_transcription) <- laboratory_transcription$Row.names
laboratory_transcription$Row.names <- NULL}
rm(laboratory_srr, x, current)
laboratory_transcription <- as.data.frame(t(laboratory_transcription))
laboratory_transcription$`*` <- NULL
# Remove low abundance samples
clinical_transcription <- as.data.frame(t(clinical_transcription))
laboratory_transcription <- as.data.frame(t(laboratory_transcription))
min_samp1 <- round(median(as.vector(colSums(clinical_transcription))) * 0.8)
min_samp2 <- round(median(as.vector(colSums(laboratory_transcription))) * 0.8)
min_samp <- min(c(min_samp1, min_samp2))
clinical_transcription <- clinical_transcription[,which(as.vector(colSums(clinical_transcription)) >= min_samp)]
laboratory_transcription <- laboratory_transcription[,which(as.vector(colSums(laboratory_transcription)) >= min_samp)]
rm(min_samp, min_samp1, min_samp2)
# Subsample data
library(vegan)
sub_samp1 <- round(median(as.vector(colSums(clinical_transcription))) * 0.8)
sub_samp2 <- round(median(as.vector(colSums(laboratory_transcription))) * 0.8)
sub_samp <- min(c(sub_samp1, sub_samp2))
for (x in 1:ncol(clinical_transcription)) {clinical_transcription[,x] <- as.vector(rrarefy(clinical_transcription[,x], sample=sub_samp))}
for (x in 1:ncol(laboratory_transcription)) {laboratory_transcription[,x] <- as.vector(rrarefy(laboratory_transcription[,x], sample=sub_samp))}
clinical_transcription <- as.data.frame(t(clinical_transcription))
laboratory_transcription <- as.data.frame(t(laboratory_transcription))
rm(sub_samp, sub_samp1, sub_samp2, x)
?write.table
# Calculate median values and save
clinical_median <- as.vector(apply(clinical_transcription, 1, median))
clinical_median <- as.data.frame(cbind(rownames(clinical_transcription), clinical_median))
View(clinical_median)
write.table(clinical_median, file='~/Desktop/active_projects/klebsiella/data/transcript_mapping/clinical_median_transript.tsv', quote=FALSE, sep='\t',row.names = FALSE, col.names = FALSE)
laboratory_median <- as.vector(apply(laboratory_transcription, 1, median))
laboratory_median <- as.data.frame(cbind(rownames(laboratory_transcription), laboratory_median))
write.table(laboratory_median, file='~/Desktop/active_projects/klebsiella/data/transcript_mapping/laboratory_median_transript.tsv', quote=FALSE, sep='\t',row.names = FALSE, col.names = FALSE)
rm(clinical_median, laboratory_median)
View(clinical_transcription)
ncol(clinical_transcription)
# Calculate median values and save
clinical_median <- as.vector(apply(clinical_transcription, 1, median))
# Calculate median values and save
clinical_median <- as.vector(apply(clinical_transcription, 2, median))
clinical_median <- as.data.frame(cbind(colnames(clinical_transcription), clinical_median))
View(clinical_median)
write.table(clinical_median, file='~/Desktop/active_projects/klebsiella/data/transcript_mapping/clinical_median_transript.tsv',
quote=FALSE, sep='\t', row.names=FALSE, col.names=FALSE)
laboratory_median <- as.vector(apply(laboratory_transcription, 2, median))
laboratory_median <- as.data.frame(cbind(colnames(laboratory_transcription), laboratory_median))
write.table(laboratory_median, file='~/Desktop/active_projects/klebsiella/data/transcript_mapping/laboratory_median_transript.tsv',
quote=FALSE, sep='\t', row.names=FALSE, col.names=FALSE)
rm(clinical_median, laboratory_median)
